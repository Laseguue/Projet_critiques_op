{% extends "base.html" %}

{% block content %}
<h1>Mes Posts</h1>

<h2>Billets</h2>
{% for ticket in tickets %}
    <div class="ticket">
        <strong>{{ ticket.title }}</strong> - <small>Créé par {{ ticket.user.username }}</small>
        <p>{{ ticket.description }}</p>
        <small class="date-label">Publié le {{ ticket.created_at|date:"d F Y à H:i" }}</small>
        {% if ticket.image %}
        <img src="{{ ticket.image.url }}" alt="{{ ticket.title }}" style="width: 200px; height: auto;">
        {% endif %}
        <div class="actions">
            <a href="{% url 'update_ticket' ticket.id %}" class="btn btn-secondary">Modifier</a>
            <a href="{% url 'delete_ticket' ticket.id %}" class="btn btn-danger">Supprimer</a>
        </div>
    </div>
{% endfor %}

<h2>Critiques</h2>
{% for review in reviews %}
    <div class="review">
        <strong>{{ review.headline }}</strong> - <small>Créé par {{ review.user.username }}</small>
        <p>Note : {{ review.rating }}</p>
        <p>{{ review.body }}</p>
        
        <!-- Aperçu du billet associé à la critique -->
        <div class="associated-ticket">
            <h4>Billet associé : {{ review.ticket.title }}</h4>
            {% if review.ticket.image %}
            <img src="{{ review.ticket.image.url }}" alt="{{ review.ticket.title }}" style="width: 150px; height: auto;">
            {% endif %}
        </div>
        
        <small class="date-label">Publié le {{ review.created_at|date:"d F Y à H:i" }}</small>
        {% if review.image %}
        <img src="{{ review.image.url }}" alt="{{ review.headline }}" style="width: 200px; height: auto;">
        {% endif %}
        <div class="actions">
            <a href="{% url 'update_review' review.id %}" class="btn btn-secondary">Modifier</a>
            <a href="{% url 'delete_review' review.id %}" class="btn btn-danger">Supprimer</a>
        </div>
    </div>
{% endfor %}

{% endblock %}
